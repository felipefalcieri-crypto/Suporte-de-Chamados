{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhe do Ticket #{{ chamado.id }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body { background-color: #f8f9fa; color: #212529; }
        #sidebar-wrapper { min-height: 100vh; margin-left: -15rem; transition: margin .25s ease-out; width: 15rem; }
        #sidebar-wrapper .sidebar-heading { padding: 0.875rem 1.25rem; font-size: 1.2rem; }
        #page-content-wrapper { min-width: 100vw; }
        @media (min-width: 768px) { #sidebar-wrapper { margin-left: 0; } #page-content-wrapper { min-width: 0; width: 100%; } }
        .card-header { font-weight: bold; }

        /* Estilo para Prioridade */
        .priority-baixa { color: #198754; font-weight: bold; }
        .priority-media { color: #ffc107; font-weight: bold; }
        .priority-alta { color: #dc3545; font-weight: bold; }
        .priority-critica { color: #6f42c1; font-weight: bold; }
    </style>
</head>
<body>

<div class="d-flex" id="wrapper">
    <div class="border-end bg-white" id="sidebar-wrapper">
        <div class="sidebar-heading border-bottom bg-light">
            Chamados
        </div>
        <div class="list-group list-group-flush">
            <a href="{% url 'home' %}"
                class="list-group-item list-group-item-action p-3 {% if request.path == '/' %}active{% endif %}"> Dashboard
            </a>
            <a href="{% url 'tickets_abertos' %}"
                class="list-group-item list-group-item-action p-3 {% if request.path == '/tickets_abertos/' %}active{% endif %}">
                </i> Tickets Abertos <span class="badge bg-danger ms-1">{{ contador.abertos|default:0 }}</span>
            </a>
            <a href="{% url 'abertura_chamado' %}"
                class="list-group-item list-group-item-action p-3 {% if request.path == '/chamado/abrir/' %}active{% endif %}">
                </i> Abrir Chamado
            </a>
        </div>
    </div>
    
    <div id="page-content-wrapper">
        
        <nav>
            <div class="container-fluid">
                <button class="btn btn-primary d-md-none" id="sidebarToggle"><i class="bi bi-list"></i></button>
            </div>
        </nav>
        
        <div class="container-fluid p-4">
            
            <h1 class="mt-4 mb-4 text-dark">{{ chamado.assunto }}</h1>
            
            <div class="row">
                
                
                <div class="col-lg-8 mb-4">
                    <div class="card shadow-lg">
                        <div class="card-header bg-primary text-white">
                            <i class="bi bi-info-circle me-2"></i> Informações do Chamado
                        </div>
                        <div class="card-body">
                            <h5 class="card-title text-primary">{{ chamado.assunto }}</h5>
                            
                            <p class="card-text text-muted small">
                                Aberto por: 
                                {% if chamado.usuario_abertura %}
                                    {{ chamado.usuario_abertura.get_full_name|default:chamado.usuario_abertura.username }}
                                {% else %}
                                    Usuário Não Atribuído
                                {% endif %}
                            </p>
                            <hr>

                            <div class="row mb-3">
                                <div class="col-sm-6">
                                    <strong><i class="bi bi-building me-1"></i> Empresa:</strong> {{ chamado.empresa }}
                                </div>
                                <div class="col-sm-6">
                                    <strong><i class="bi bi-calendar-event me-1"></i> Data Abertura:</strong> {{ chamado.data_abertura|date:"d/m/Y H:i" }}
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-sm-6">
                                    <strong><i class="bi bi-person-gear me-1"></i> Técnico:</strong> 
                                    <span class="badge bg-secondary">
                                        {% if chamado.tecnico_responsavel %}
                                            {{ chamado.tecnico_responsavel.get_full_name|default:chamado.tecnico_responsavel.username }}
                                        {% else %}
                                            Não Atribuído
                                        {% endif %}
                                    </span>
                                </div>
                                <div class="col-sm-6">
                                    <strong><i class="bi bi-flag-fill me-1"></i> Prioridade:</strong>
                                    <span class="
                                        {% if chamado.prioridade == 'ALTA' %}priority-alta
                                        {% elif chamado.prioridade == 'MEDIA' %}priority-media
                                        {% elif chamado.prioridade == 'CRITICA' %}priority-critica
                                        {% else %}priority-baixa
                                        {% endif %}">
                                        {{ chamado.get_prioridade_display|upper }}
                                    </span>
                                </div>
                            </div>
                            
                            <hr>
                            
                            <h6><i class="bi bi-file-text me-1"></i> Descrição:</h6>
                            <p>{{ chamado.descricao|linebreaksbr }}</p>
                            
                            {% if chamado.data_encerramento %}
                            <p class="mt-4 text-success small">
                                <i class="bi bi-check-circle-fill"></i> Encerrado em: {{ chamado.data_encerramento|date:"d/m/Y H:i" }}
                            </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4 mb-4">
                    <div class="card shadow-lg bg-light">
                        <div class="card-header bg-warning text-dark">
                            <i class="bi bi-pencil-square me-2"></i> Atualizar Chamado
                        </div>
                        <div class="card-body">
                            <h5 class="mb-3">
                                Status Atual: 
                                {% if chamado.status == 'NOVO' %}
                                    <span class="badge bg-warning text-dark">{{ chamado.get_status_display }}</span>
                                {% elif chamado.status == 'ANDAMENTO' %}
                                    <span class="badge bg-info text-dark">{{ chamado.get_status_display }}</span>
                                {% elif chamado.status == 'PENDENTE' %}
                                    <span class="badge bg-danger">{{ chamado.get_status_display }}</span>
                                {% else %}
                                    <span class="badge bg-success">{{ chamado.get_status_display }}</span>
                                {% endif %}
                            </h5>

                            <form method="post" action="{% url 'atualizar_chamado' chamado.id %}">
                                {% csrf_token %}
                                
                                <div class="mb-3">
                                    <label for="id_status" class="form-label">Novo Status:</label>
                                    {{ form.status }}
                                </div>
                                
                                <div class="mb-3">
                                    <label for="id_tecnico_responsavel" class="form-label">Atribuir Técnico:</label>
                                    {{ form.tecnico_responsavel }}
                                </div>
                                
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-success mt-3">
                                        <i class="bi bi-save me-1"></i> Salvar Alterações
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            </div>
            </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById('sidebarToggle').addEventListener('click', function() {
        var wrapper = document.getElementById('wrapper');
        wrapper.classList.toggle('toggled');
    });
</script>

</body>
</html>